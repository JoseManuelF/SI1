--DROP INDEX index_name ON table_name;

--CREATE INDEX index_name
--ON table_name (column1, column2, ...);

--DROP INDEX date_;
CREATE INDEX date_ ON public.orders (orderdate);

EXPLAIN ANALYZE SELECT
	COUNT(CustomerAmount.customerid)
FROM
	(
	SELECT 
		customers.customerid, 
		SUM(orders.totalamount) AS amount
	FROM 
		public.customers, 
		public.orders
	WHERE 
		orders.customerid = customers.customerid AND
		EXTRACT(year FROM orders.orderdate) = 2019 AND
		EXTRACT(month FROM orders.orderdate) = 11
	GROUP BY customers.customerid
	) AS CustomerAmount
WHERE
	CustomerAmount.amount >= 2
;
